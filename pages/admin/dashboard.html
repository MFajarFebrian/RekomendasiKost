<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SiKost</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="../../assets/css/components.css">
    <link rel="stylesheet" href="../../assets/css/responsive.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <a href="/RekomendasiKost/" class="navbar-brand">SiKost <span class="badge badge-primary">Admin</span></a>
            <ul class="nav-menu">
                <li><a href="dashboard.html" class="nav-link active">Dashboard</a></li>
                <li><a href="manage-kost.html" class="nav-link">Manage Kost</a></li>
                <li><a href="configure-ahp.html" class="nav-link">Konfigurasi AHP</a></li>
                <li><a href="#" class="nav-link" onclick="logout(); return false;">Logout</a></li>
            </ul>
            <button class="nav-toggle"><span></span><span></span><span></span></button>
        </div>
    </nav>

    <main style="padding-top: 100px;">
        <section class="section-sm">
            <div class="container">
                <h1 class="mb-6">Dashboard Admin</h1>

                <!-- Stats Cards -->
                <div class="grid grid-4 mb-6" id="stats-grid">
                    <div class="card" style="padding: var(--space-5); text-align: center;">
                        <p class="text-secondary">Total Kost</p>
                        <h2 id="stat-kost">-</h2>
                    </div>
                    <div class="card" style="padding: var(--space-5); text-align: center;">
                        <p class="text-secondary">Rata-rata Harga</p>
                        <h2 id="stat-avg">-</h2>
                    </div>
                    <div class="card" style="padding: var(--space-5); text-align: center;">
                        <p class="text-secondary">Harga Terendah</p>
                        <h2 id="stat-min">-</h2>
                    </div>
                    <div class="card" style="padding: var(--space-5); text-align: center;">
                        <p class="text-secondary">Harga Tertinggi</p>
                        <h2 id="stat-max">-</h2>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card mb-6" style="padding: var(--space-5);">
                    <h4 class="mb-4">Quick Actions</h4>
                    <div class="flex" style="gap: var(--space-3);">
                        <a href="manage-kost.html" class="btn btn-primary">‚ûï Tambah Kost</a>
                        <a href="configure-ahp.html" class="btn btn-secondary">‚öôÔ∏è Konfigurasi AHP</a>
                        <a href="/RekomendasiKost/pages/recommendations.html" class="btn btn-outline">üìä Lihat
                            Ranking</a>
                    </div>
                </div>

                <!-- Current Weights -->
                <div class="card" style="padding: var(--space-5);">
                    <h4 class="mb-4">Bobot Kriteria Saat Ini</h4>
                    <div id="weights-display">
                        <div class="text-center p-6"
                            style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px;">
                            <div class="spinner"></div>
                            <p class="mt-4 text-secondary">Memuat bobot kriteria...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="../../assets/js/api.js"></script>
    <script src="../../assets/js/utils.js"></script>
    <script src="../../assets/js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Check admin access
            const user = await checkAuth();
            if (!user || user.role !== 'admin') {
                window.location.href = '/RekomendasiKost/pages/login.html';
                return;
            }

            await loadStats();
            await loadWeights();
        });

        async function loadStats() {
            try {
                const data = await KostAPI.getAll({ limit: 1000 });
                const items = data.items;

                document.getElementById('stat-kost').textContent = items.length;

                if (items.length > 0) {
                    const prices = items.map(k => k.harga);
                    const avg = prices.reduce((a, b) => a + b, 0) / prices.length;
                    document.getElementById('stat-avg').textContent = formatCurrency(avg);
                    document.getElementById('stat-min').textContent = formatCurrency(Math.min(...prices));
                    document.getElementById('stat-max').textContent = formatCurrency(Math.max(...prices));
                }
            } catch (e) {
                console.error(e);
            }
        }

        async function loadWeights() {
            try {
                const data = await SPKAPI.getWeights();
                let html = '<ul class="weights-list">';
                Object.entries(data.weights).forEach(([key, val]) => {
                    const name = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    html += `<li><span>${name}</span><strong>${formatPercent(val)}</strong></li>`;
                });
                html += '</ul>';
                document.getElementById('weights-display').innerHTML = html;
            } catch (e) {
                document.getElementById('weights-display').innerHTML = '<p class="text-danger">Gagal memuat bobot.</p>';
            }
        }
    </script>
</body>

</html>